# 智能工作流自动化功能文档

## 📋 功能概述

智能工作流自动化功能允许用户创建自定义工作流，一键完成从关键词生成到验证的完整流程，大幅提升工作效率。

## 🎯 核心功能

### 1. 自定义工作流
- 支持创建包含多个步骤的工作流
- 步骤类型包括：
  - **关键词生成**：自动生成关键词
  - **内容创作**：为关键词生成多平台内容
  - **内容优化**：优化现有内容
  - **验证**：验证品牌提及率
  - **条件检查**：根据条件触发后续操作

### 2. 工作流模板
- 保存常用工作流为模板
- 从模板快速创建工作流
- 模板复用，提升效率

### 3. 批量处理
- 一次性处理多个关键词
- 自动为多个平台生成内容
- 批量验证关键词效果

### 4. 条件触发
- 当提及率低于阈值时自动优化
- 支持自定义条件和动作
- 灵活的工作流控制

### 5. 执行历史
- 记录所有工作流执行记录
- 查看执行状态和结果
- 错误日志和调试信息

## 🚀 使用指南

### 创建工作流

1. **进入工作流管理**
   - 在 Tab7（工作流自动化）中，点击"创建工作流"标签页

2. **从模板创建（推荐）**
   - 选择预设的工作流模板
   - 输入工作流名称
   - 点击"创建"按钮

3. **自定义工作流**
   - 输入工作流名称
   - 添加步骤：
     - 选择步骤类型（关键词生成、内容创作、验证等）
     - 配置步骤参数
     - 点击"添加步骤"
   - 重复添加多个步骤
   - 点击"创建工作流"按钮

### 执行工作流

1. **在工作流列表中**
   - 找到要执行的工作流
   - 点击"▶️ 执行"按钮
   - 等待执行完成

2. **查看执行结果**
   - 执行完成后会显示成功或失败信息
   - 点击"查看执行结果"展开详情
   - 在"执行历史"标签页查看所有历史记录

### 工作流步骤配置

#### 关键词生成步骤
- **参数**：
  - `num_keywords`: 生成关键词数量（默认：10）
  - `generation_mode`: 生成模式（AI生成/托词工具/混合模式）

#### 内容创作步骤
- **参数**：
  - `platforms`: 目标平台列表（如：["知乎", "小红书"]）

#### 验证步骤
- **参数**：
  - `verify_models`: 验证模型列表（如：["DeepSeek", "OpenAI"]）
  - `max_keywords`: 最多验证的关键词数量（默认：20）

#### 条件检查步骤
- **参数**：
  - `condition_type`: 条件类型（如：`mention_rate`）
  - `threshold`: 阈值（如：0.5 表示 50%）
  - `action`: 动作（`skip` 跳过后续步骤，`continue` 继续执行）

## 📊 工作流示例

### 示例1：完整流程工作流
```
1. 关键词生成（10个，AI生成）
2. 内容创作（知乎、小红书）
3. 验证（DeepSeek、OpenAI）
4. 条件检查（提及率 < 50% 时跳过）
```

### 示例2：快速验证工作流
```
1. 关键词生成（20个，混合模式）
2. 验证（所有可用模型）
```

### 示例3：内容优化工作流
```
1. 内容创作（微信公众号）
2. 内容优化（通用优化）
3. 验证（DeepSeek）
```

## 🔧 技术实现

### 架构设计
- **WorkflowExecutor**: 工作流执行引擎
- **WorkflowManager**: 工作流管理器
- **DataStorage**: 数据持久化（SQLite）

### 数据存储
- `workflows` 表：存储工作流配置
- `workflow_executions` 表：存储执行记录
- `workflow_templates` 表：存储工作流模板

### 执行流程
1. 用户点击"执行"按钮
2. WorkflowManager 创建工作流执行器
3. 执行器按顺序执行每个步骤
4. 每个步骤调用相应的回调函数
5. 结果保存到数据库
6. 返回执行结果

## ⚠️ 注意事项

1. **API 成本**
   - 工作流执行会消耗 API 调用
   - 建议在批量处理前估算成本
   - 可以使用 `max_keywords` 参数限制验证数量

2. **执行时间**
   - 复杂工作流可能需要较长时间
   - 建议在非高峰期执行
   - 可以分步骤执行，避免超时

3. **错误处理**
   - 如果某个步骤失败，工作流会停止
   - 查看执行日志了解失败原因
   - 可以修改工作流配置后重试

4. **数据依赖**
   - 确保已配置必要的 API Key
   - 确保有足够的关键词数据
   - 确保品牌和优势信息已填写

## 🎯 最佳实践

1. **从简单开始**
   - 先创建简单的工作流测试
   - 逐步增加复杂度

2. **使用模板**
   - 保存常用工作流为模板
   - 从模板快速创建新工作流

3. **定期检查**
   - 查看执行历史
   - 分析执行结果
   - 优化工作流配置

4. **条件触发**
   - 使用条件检查步骤
   - 根据结果自动调整流程

## 📈 未来增强

- [ ] 定时任务支持（使用 APScheduler）
- [ ] 工作流可视化编辑器
- [ ] 更多条件类型支持
- [ ] 工作流性能优化
- [ ] 工作流分享功能

---

**创建日期**：2025-01-26  
**版本**：1.0.0
